<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë²¤íŠ¸ ê´€ë¦¬ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 3px; }
        textarea { height: 100px; resize: vertical; }
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .result { margin-top: 20px; padding: 10px; background-color: #f8f9fa; border-radius: 3px; }
        .error { color: red; }
        .success { color: green; }
        .image-preview { margin-top: 10px; }
        .image-preview img { max-width: 200px; max-height: 200px; margin: 5px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ ì´ë²¤íŠ¸ ê´€ë¦¬ í…ŒìŠ¤íŠ¸</h1>

        <!-- ì´ë²¤íŠ¸ ìƒì„± -->
        <div class="section">
            <h2>ğŸ“ ì´ë²¤íŠ¸ ìƒì„±</h2>
            <form id="createForm">
                <div class="form-group">
                    <label for="eventType">ì´ë²¤íŠ¸ íƒ€ì…</label>
                    <select id="eventType" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="MUSICAL">ë®¤ì§€ì»¬</option>
                        <option value="MOVIE">ì˜í™”</option>
                        <option value="THEATER">ì—°ê·¹</option>
                        <option value="EXHIBITION">ì „ì‹œ</option>
                        <option value="Classical">í´ë˜ì‹</option>
                        <option value="DANCE">ë¬´ìš©</option>
                        <option value="CONCERT">ì½˜ì„œíŠ¸</option>
                        <option value="FESTIVAL">í˜ìŠ¤í‹°ë²Œ</option>
                        <option value="LOCAL_EVENT">ì§€ì—­ í–‰ì‚¬</option>
                        <option value="OTHER">ê¸°íƒ€</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="title">ì œëª©</label>
                    <input type="text" id="title" required>
                </div>

                <div class="form-group">
                    <label for="sido">ì‹œ/ë„ (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="sido" placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ">
                </div>

                <div class="form-group">
                    <label for="sigungu">ì‹œ/êµ°/êµ¬ (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="sigungu" placeholder="ì˜ˆ: ê°•ë‚¨êµ¬">
                </div>

                <div class="form-group">
                    <label for="eventLocation">ì¥ì†Œëª…</label>
                    <input type="text" id="eventLocation" required>
                </div>

                <div class="form-group">
                    <label for="address">ì£¼ì†Œ (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="address">
                </div>

                <div class="form-group">
                    <label for="addressDetail">ìƒì„¸ì£¼ì†Œ (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="addressDetail">
                </div>

                <div class="form-group">
                    <label for="startDate">ì‹œì‘ì¼</label>
                    <input type="date" id="startDate" required>
                </div>

                <div class="form-group">
                    <label for="endDate">ì¢…ë£Œì¼</label>
                    <input type="date" id="endDate" required>
                </div>

                <div class="form-group">
                    <label for="durationMin">ì†Œìš”ì‹œê°„(ë¶„) (ì„ íƒì‚¬í•­)</label>
                    <input type="number" id="durationMin" min="0" placeholder="ì˜ˆ: 120">
                </div>

                <div class="form-group">
                    <label for="minAge">ìµœì†Œ ì—°ë ¹ (ì„ íƒì‚¬í•­)</label>
                    <input type="number" id="minAge" min="0" placeholder="ê¸°ë³¸ê°’: 0">
                </div>

                <div class="form-group">
                    <label for="description">ì„¤ëª…</label>
                    <textarea id="description" required></textarea>
                </div>

                <div class="form-group">
                    <label for="mainImage">ë©”ì¸ ì´ë¯¸ì§€</label>
                    <input type="file" id="mainImage" accept="image/*">
                    <div id="mainImagePreview" class="image-preview"></div>
                </div>

                <div class="form-group">
                    <label for="contentImages">ì„¤ëª… ì´ë¯¸ì§€ë“¤</label>
                    <input type="file" id="contentImages" accept="image/*" multiple>
                    <div id="contentImagesPreview" class="image-preview"></div>
                </div>

                <button type="submit">ì´ë²¤íŠ¸ ìƒì„±</button>
            </form>
            <div id="createResult" class="result" style="display:none;"></div>
        </div>

        <!-- ì´ë²¤íŠ¸ ëª©ë¡ ì¡°íšŒ -->
        <div class="section">
            <h2>ğŸ“‹ ì´ë²¤íŠ¸ ëª©ë¡</h2>
            <button onclick="loadEvents()">ì´ë²¤íŠ¸ ëª©ë¡ ì¡°íšŒ</button>
            <div id="eventsList" class="result" style="display:none;"></div>
        </div>

        <!-- íŠ¹ì • ì´ë²¤íŠ¸ ì¡°íšŒ -->
        <div class="section">
            <h2>ğŸ” ì´ë²¤íŠ¸ ìƒì„¸ ì¡°íšŒ</h2>
            <div class="form-group">
                <label for="eventId">ì´ë²¤íŠ¸ ID</label>
                <input type="number" id="eventId">
            </div>
            <button onclick="loadEventDetail()">ìƒì„¸ ì •ë³´ ì¡°íšŒ</button>
            <div id="eventDetail" class="result" style="display:none;"></div>
        </div>

        <!-- ì´ë²¤íŠ¸ ê²€ìƒ‰ -->
        <div class="section">
            <h2>ğŸ” ì´ë²¤íŠ¸ ê²€ìƒ‰</h2>
            <div class="form-group">
                <label for="searchTitle">ì œëª©</label>
                <input type="text" id="searchTitle">
            </div>
            <div class="form-group">
                <label for="searchSido">ì‹œ/ë„</label>
                <input type="text" id="searchSido">
            </div>
            <div class="form-group">
                <label for="searchEventType">ì´ë²¤íŠ¸ íƒ€ì…</label>
                <select id="searchEventType">
                    <option value="">ì „ì²´</option>
                    <option value="MUSICAL">ë®¤ì§€ì»¬</option>
                    <option value="MOVIE">ì˜í™”</option>
                    <option value="THEATER">ì—°ê·¹</option>
                    <option value="EXHIBITION">ì „ì‹œ</option>
                    <option value="Classical">í´ë˜ì‹</option>
                    <option value="DANCE">ë¬´ìš©</option>
                    <option value="CONCERT">ì½˜ì„œíŠ¸</option>
                    <option value="FESTIVAL">í˜ìŠ¤í‹°ë²Œ</option>
                    <option value="LOCAL_EVENT">ì§€ì—­ í–‰ì‚¬</option>
                    <option value="OTHER">ê¸°íƒ€</option>
                </select>
            </div>
            <button onclick="searchEvents()">ê²€ìƒ‰</button>
            <div id="searchResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        document.getElementById('mainImage').addEventListener('change', function(e) {
            previewImage(e.target.files[0], 'mainImagePreview');
        });

        document.getElementById('contentImages').addEventListener('change', function(e) {
            previewImages(e.target.files, 'contentImagesPreview');
        });

        function previewImage(file, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    container.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }

        function previewImages(files, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    container.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }

        // ì´ë²¤íŠ¸ ìƒì„±
        document.getElementById('createForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            
            // ì§€ì—­ ì •ë³´ ì²˜ë¦¬
            const sido = document.getElementById('sido').value;
            const sigungu = document.getElementById('sigungu').value;
            const regionDto = (sido || sigungu) ? { sido: sido || null, sigungu: sigungu || null } : null;

            // JSON ë°ì´í„° ìƒì„±
            const eventData = {
                eventType: document.getElementById('eventType').value,
                title: document.getElementById('title').value,
                regionDto: regionDto,
                eventLocation: document.getElementById('eventLocation').value,
                address: document.getElementById('address').value || null,
                addressDetail: document.getElementById('addressDetail').value || null,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                durationMin: document.getElementById('durationMin').value ? parseInt(document.getElementById('durationMin').value) : null,
                minAge: document.getElementById('minAge').value ? parseInt(document.getElementById('minAge').value) : null,
                description: document.getElementById('description').value
            };

            // JSONì„ Blobìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì¶”ê°€ (multipart/form-dataì—ì„œ JSON ê°ì²´ ì „ì†¡)
            formData.append('eventRequestDto', new Blob([JSON.stringify(eventData)], {type: 'application/json'}));

            // ë©”ì¸ ì´ë¯¸ì§€ ì¶”ê°€
            const mainImage = document.getElementById('mainImage').files[0];
            if (mainImage) {
                formData.append('mainImage', mainImage);
            }

            // ì„¤ëª… ì´ë¯¸ì§€ë“¤ ì¶”ê°€
            const contentImages = document.getElementById('contentImages').files;
            for (let file of contentImages) {
                formData.append('imagesToAdd', file);
            }

            try {
                const response = await fetch('/api/v1/events', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                const resultDiv = document.getElementById('createResult');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h4>âœ… ì´ë²¤íŠ¸ ìƒì„± ì„±ê³µ!</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <h4>âŒ ìƒì„± ì‹¤íŒ¨</h4>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                const resultDiv = document.getElementById('createResult');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h4>âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</h4><p>${error.message}</p>`;
            }
        });

        // ì´ë²¤íŠ¸ ëª©ë¡ ì¡°íšŒ
        async function loadEvents() {
            try {
                const response = await fetch('/api/v1/events');
                const events = await response.json();
                const resultDiv = document.getElementById('eventsList');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = `
                        <h4>ğŸ“‹ ì´ë²¤íŠ¸ ëª©ë¡ (ì´ ${events.length}ê°œ)</h4>
                        <pre>${JSON.stringify(events, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h4>âŒ ì¡°íšŒ ì‹¤íŒ¨</h4><pre>${JSON.stringify(events, null, 2)}</pre>`;
                }
            } catch (error) {
                const resultDiv = document.getElementById('eventsList');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h4>âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</h4><p>${error.message}</p>`;
            }
        }

        // íŠ¹ì • ì´ë²¤íŠ¸ ìƒì„¸ ì¡°íšŒ
        async function loadEventDetail() {
            const eventId = document.getElementById('eventId').value;
            if (!eventId) {
                alert('ì´ë²¤íŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`/api/v1/events/${eventId}`);
                const event = await response.json();
                const resultDiv = document.getElementById('eventDetail');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = `
                        <h4>ğŸ” ì´ë²¤íŠ¸ ìƒì„¸ì •ë³´</h4>
                        <pre>${JSON.stringify(event, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h4>âŒ ì¡°íšŒ ì‹¤íŒ¨</h4><pre>${JSON.stringify(event, null, 2)}</pre>`;
                }
            } catch (error) {
                const resultDiv = document.getElementById('eventDetail');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h4>âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</h4><p>${error.message}</p>`;
            }
        }

        // ì´ë²¤íŠ¸ ê²€ìƒ‰
        async function searchEvents() {
            const params = new URLSearchParams();
            
            const title = document.getElementById('searchTitle').value;
            const sido = document.getElementById('searchSido').value;
            const eventType = document.getElementById('searchEventType').value;
            
            if (title) params.append('keyword', title);
            if (sido) {
                params.append('regionDto.level1', sido);
            }
            if (eventType) params.append('eventType', eventType);

            try {
                const response = await fetch(`/api/v1/events/search?${params.toString()}`);
                const events = await response.json();
                const resultDiv = document.getElementById('searchResult');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = `
                        <h4>ğŸ” ê²€ìƒ‰ ê²°ê³¼ (ì´ ${events.length}ê°œ)</h4>
                        <pre>${JSON.stringify(events, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h4>âŒ ê²€ìƒ‰ ì‹¤íŒ¨</h4><pre>${JSON.stringify(events, null, 2)}</pre>`;
                }
            } catch (error) {
                const resultDiv = document.getElementById('searchResult');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h4>âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</h4><p>${error.message}</p>`;
            }
        }
    </script>
</body>
</html>