<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>채팅</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  <style>
    #chat-box {
        width: 500px;
        height: 400px;
        border: 1px solid #ccc;
        overflow-y: scroll;
        padding: 10px;
        margin-bottom: 10px;
    }
    #message {
        width: 400px;
    }
  </style>
</head>
<body>
<h2>채팅방</h2>

<div id="chat-box"></div>

<input type="text" id="message" placeholder="메시지를 입력하세요" />
<button onclick="sendMessage()">전송</button>

<script>
  let stompClient = null;
  const roomId = /*[[${roomId}]]*/ 1; // 채팅방 ID를 서버에서 전달
  const senderId = /*[[${memberId}]]*/ 1; // 로그인한 사용자 ID

  function connect() {
      const socket = new SockJS('/ws-chat');
      stompClient = Stomp.over(socket);
      stompClient.connect({}, function (frame) {
          console.log('Connected: ' + frame);
          stompClient.subscribe('/topic/chatroom/' + roomId, function (message) {
              showMessage(JSON.parse(message.body));
          });
      });
  }

  function sendMessage() {
      const content = document.getElementById('message').value;
      if (content && stompClient) {
          const chatMessage = {
              roomId: roomId,
              senderId: senderId,
              content: content
          };
          stompClient.send("/app/chat.sendMessage", {}, JSON.stringify(chatMessage));
          document.getElementById('message').value = '';
      }
  }

  function showMessage(message) {
      const chatBox = document.getElementById('chat-box');
      const msgDiv = document.createElement('div');
      msgDiv.textContent = `User ${message.senderId}: ${message.content}`;
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
  }

  connect();
</script>
</body>
</html>